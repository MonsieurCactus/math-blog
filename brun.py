# Brun "fully subtractive" Euclidean Algorithm
#
# Viggo Brun observes you can get "periodic" continued fraction -- with pattern that repeats itself.  He uses his special method to tune a piano
# 
# http://mathoverflow.net/questions/176999/bruns-algorithm
# 
# http://jolivet.org/timo/docs/Brun_algo.pdf

import numpy as np

w = [1,2**0.33333333333, 4**0.33333333333]
z = [1,2**0.33333333333, 4**0.33333333333]
x = np.array([[1,0,0],[0,1,0],[0,0,1]])
y = np.array([[1,0,0],[0,1,0],[0,0,1]])
code = ''

T = 3
for k in range(1+18*T):
    #z = [z[0], z[1], z[2]-z[1]]

    x = np.dot(np.array([[1,0,0],[0,1,1],[0,0,1]]),x)
    y = np.dot(np.array([[1,0,0],[0,1,0],[0,-1,1]]),y)
    z = np.dot(y,w)
    
    if(z[2] > z[1]):
        print "a",
        code += 'a'
        x = np.dot(np.array([[1,0,0],[0,1,0],[0,0,1]]),x)
        y = np.dot(np.array([[1,0,0],[0,1,0],[0,0,1]]),y)        
    if(z[2] < z[1] and z[2] > z[0]):
        print "b",
        code += 'b'
        #z = [z[0], z[2], z[1]]
        x = np.dot(np.array([[1,0,0],[0,0,1],[0,1,0]]),x)
        y = np.dot(np.array([[1,0,0],[0,0,1],[0,1,0]]),y)        
    if(z[2] < z[1] and z[2] < z[0]):
        print "c",
        #z = [z[2], z[0], z[1]]
        code += 'c'
        x = np.dot(np.array([[0,0,1],[1,0,0],[0,1,0]]),x)
        y = np.dot(np.array([[0,0,1],[1,0,0],[0,1,0]]),y)
        
    print np.dot(y,w)
    
for k in range(T):
    print code[1+k*18: 1+(k+1)*18]

z, (code[1:19]== code[19:37]),np.dot(z,x),x, 
#z, (code[1:19]== code[19:37]), code[1:1+18], code[1+18:1+2*18], code[1+2*18:1+3*18], np.dot(x,z)

"""
c [ 0.32748     1.          1.25992105]
c [ 0.25992105  0.32748     1.        ]
a [ 0.25992105  0.32748     0.67252   ]
a [ 0.25992105  0.32748     0.34504   ]
c [ 0.01755999  0.25992105  0.32748   ]
b [ 0.01755999  0.06755895  0.25992105]
a [ 0.01755999  0.06755895  0.1923621 ]
a [ 0.01755999  0.06755895  0.12480315]
b [ 0.01755999  0.05724419  0.06755895]
c [ 0.01031476  0.01755999  0.05724419]
a [ 0.01031476  0.01755999  0.0396842 ]
a [ 0.01031476  0.01755999  0.02212421]
c [ 0.00456421  0.01031476  0.01755999]
b [ 0.00456421  0.00724523  0.01031476]
c [ 0.00306952  0.00456421  0.00724523]
c [ 0.00268102  0.00306952  0.00456421]
c [ 0.00149469  0.00268102  0.00306952]
c [ 0.0003885   0.00149469  0.00268102]
b [ 0.0003885   0.00118633  0.00149469]
c [ 0.00030835  0.0003885   0.00118633]
a [ 0.00030835  0.0003885   0.00079783]
a [ 0.00030835  0.0003885   0.00040933]
c [  2.08323271e-05   3.08353290e-04   3.88500842e-04]
b [  2.08323271e-05   8.01475524e-05   3.08353290e-04]
a [  2.08323271e-05   8.01475524e-05   2.28205737e-04]
a [  2.08323271e-05   8.01475524e-05   1.48058185e-04]
b [  2.08323271e-05   6.79106325e-05   8.01475524e-05]
c [  1.22369198e-05   2.08323271e-05   6.79106325e-05]
a [  1.22369198e-05   2.08323271e-05   4.70783055e-05]
a [  1.22369198e-05   2.08323271e-05   2.62459784e-05]
c [  5.41365125e-06   1.22369198e-05   2.08323271e-05]
b [  5.41365125e-06   8.59540728e-06   1.22369198e-05]
c [  3.64151254e-06   5.41365125e-06   8.59540728e-06]
c [  3.18175603e-06   3.64151254e-06   5.41365125e-06]
c [  1.77213873e-06   3.18175603e-06   3.64151254e-06]
c [  4.59756507e-07   1.77213873e-06   3.18175603e-06]
b [  4.59756507e-07   1.40961731e-06   1.77213873e-06]
c [  3.62521462e-07   4.59756507e-07   1.40961731e-06]
a [  3.62521462e-07   4.59756507e-07   9.49860578e-07]
a [  3.62521462e-07   4.59756507e-07   4.90103957e-07]
c [  3.03475645e-08   3.62521462e-07   4.59756507e-07]
b [  3.03475645e-08   9.72352154e-08   3.62521462e-07]
a [  3.03475645e-08   9.72352154e-08   2.65286559e-07]
a [  3.03475645e-08   9.72352154e-08   1.68051315e-07]
b [  3.03475645e-08   7.08166681e-08   9.72352154e-08]
c [  2.64190021e-08   3.03475645e-08   7.08166681e-08]
a [  2.64190021e-08   3.03475645e-08   4.04686489e-08]
c [  1.01217665e-08   2.64190021e-08   3.03475645e-08]
c [  3.92901711e-09   1.01217665e-08   2.64190021e-08]
a [  3.92901711e-09   1.01217665e-08   1.62976903e-08]
b [  3.92901711e-09   6.17728801e-09   1.01217665e-08]
b [  3.92901711e-09   3.94356903e-09   6.17728801e-09]
c [  2.23008101e-09   3.92901711e-09   3.94356903e-09]
c [  1.81898940e-11   2.23008101e-09   3.92901711e-09]
b [  1.81898940e-11   1.69529812e-09   2.23008101e-09]
caacbaabcaacbccccb
caacbaabcaacbccccb
caacbaabcaccabbccb

(array([  1.81898940e-11,   2.23008101e-09,   1.69529812e-09]),
 True,
 array([ 0.94492948,  1.19053654,  1.49998205]),
 array([[173816861, 218995522, 275917068],
        [195801379, 246694279, 310815315],
        [297950447, 375394040, 472966853]]))
"""
